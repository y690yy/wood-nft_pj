<!DOCTYPE html>
<html>
<head>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const numbers = [1, 2, 3, 4, 5];
      const markers = [
        {
          patt: "aruco_generater/240223_aruco_generated_patt/aruco_0.patt",
          images: numbers.map(num => ({
            src: `ntf_figures/figure_${num}.png`,
            link: `https://woodnft.github.io/woodnft-demo/#/CardDetailPage/${num}`
          }))
        }
      ];

      markers.forEach((marker, index) => {
        const scene = document.querySelector("a-scene");
        const aMarker = document.createElement("a-marker");
        aMarker.setAttribute("type", "pattern");
        aMarker.setAttribute("url", marker.patt);
        aMarker.setAttribute("id", `marker-${index}`);

        let currentImageIndex = 0;
        const displayNextImage = () => {
          // Remove any existing image before adding a new one
          const existingImage = aMarker.querySelector("a-image");
          if (existingImage) {
            aMarker.removeChild(existingImage);
          }

          if (currentImageIndex >= marker.images.length) {
            currentImageIndex = 0; // Reset index to loop
          }

          const image = marker.images[currentImageIndex];
          const aImage = document.createElement("a-image");
          aImage.setAttribute("src", image.src);
          aImage.setAttribute("width", "1");
          aImage.setAttribute("height", "1");
          aImage.setAttribute("position", "1 0 0"); 
          aImage.setAttribute("rotation", "180 0 0"); 
          aImage.setAttribute("scale","1.5 1.5 0");

          aImage.addEventListener("click", (event) => {
            event.stopPropagation();
            window.location.href = image.link;
          });

          aMarker.appendChild(aImage);

          // 3Dモデルの追加
          if(marker.patt === "aruco_generater/240223_aruco_generated_patt/aruco_0.patt") {
            const aModel = document.createElement("a-model");
            aModel.setAttribute("src", "url(3d_model/chimera1.obj)");
            aModel.setAttribute("mtl", "url(3d_model/chimera1.mtl)");
            aModel.setAttribute("position", "-1 0 0");
            aModel.setAttribute("scale","1.5 1.5 1.5");
            aMarker.appendChild(aModel);
          }
          currentImageIndex++;
          setTimeout(displayNextImage, 1000); // Display next image after 1 second
        };

        // Start the image display loop
        displayNextImage();

        scene.appendChild(aMarker);
      });
    });
  </script>
</head>
<body>
  <a-scene embedded arjs="patternRatio:0.80" vr-mode-ui="enabled: false">
    <a-entity camera cursor="fuse: false; rayOrigin : mouse;"></a-entity>
  </a-scene>
</body>
</html>